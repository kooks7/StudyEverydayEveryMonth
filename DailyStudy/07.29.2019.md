## July.29.2019  (Mon)

# **Learned Today** 

## 1. SQL

* **SQL Injection 방어기법**

  1. 정적쿼리를 사용 = 구조화된 쿼리 실행 = 파라미터화된 쿼리 실행 = 입력값에 따라 쿼리문의 구조가 바뀌지 않도록 한다. = PreparedStatement 객체를 이용해서 쿼리를 실행
  2.  ORM 프레임워크를 사용하는 경우, 외부 입력값을 쿼리맵에 바인딩할 때 반드시 #기호를 이용한다.
  3. 입력값을 검증 => 외부 입력값에 쿼리 조작 문자열 포함 여부를 검증 후 쿼리문 생성 및 실행에 사용
  4. 오류 메시지에 시스템 정보가 노출되지 않도록 한다. => Error-based SQL Injection 공격을 완화
  5. DB 사용자의 권한을 최소로 부여한다. => 해당 어플리케이션에서 사용하는 DB 객체에 대해서만 권한을 부여한다. => Stored Procedure 또는 UNION-based SQL Injection 공격을 완화

  

*  MyBatis $과 #의 차이

* **운영체제 명령어 삽입(Command Injection)**

  운영체제 명령어 실행 부분이 존재하는 경우외부 입력값을 검증, 제한 없이 운영체제 명령어 실행 부분에 운영체제 명령어 또는 명령어의 일부로 사용되는 경우 발생

  

  * **외부 입력값을 검증, 제한 없이 운영체제 명령어로 사용하는 경우**

    * 입력값이 명령어로 사용
    * 정상 입력 : .../doSomething.jsp?cmd=ls
    * 비정상 입력: .../doSomething.jsp?cmd=ipconfig => 의도하지 않은 명령어 실행이 가능 => 서버의 제어권이 탈취될 수 있음
    * String input = request.getParameter("cmd");Runtime.getRuntime().exec(input);

    

  * **외부 입력값을 검증, 제한 없이 운영체제 명령어의 일부로 사용하는 경우**
    * 입력값이 명령어의 파라미터로 사용
    * 정상 입력: .../doSomething.jsp?data=help.txt => c:\data\help.txt 파일의 내용을 출력
    * 비정상 입력: .../doSomething.jsp?data=help.txt & ipconfig => c:/data\help.txt 파일 내용과 함께 서버의 IP 정보가 함께 출력 => 의도하지 않은 추가 명령어 실행이 가능 => 서버의 제어권이 함께 탈취될 수 있음
    * String input = request.getParameter("data");Runtime.getRuntime().exec("cmd.exe /c type c:\\data\\" + input);
    * 제한 방법
      1) White List 방식 = 허용 목록 
      2) Black List 방식 = 제한 목록 (모집합이 크고 변화가 클때 사용)
      ex) 입력값 유형 a, b, c 중 a는 안전하고 b, c 는 안전하지 않은 경우
            허용 목력 = [a]          => a,b,c,x,y  -> a        ( 새로운  유형의 입력도 보안성을 제공한다.)
            제한 목록 = [b, c]      => a,b,c,x,y -> a, x, y  (검증되지 않은 새로운 유형을 방어할 수 없다.)

  * 운영체제 명령어 삽입 취약점 방어 기법
    1) 운영체제 명령어 실행 부분위 필요성 여부 및 대체 가능 여부를 판정
    2) 사용할 명령어를 미리 정의하고, 정의된 범위 내에서 사용되도록 한다. 
         = 화이트 리스트 방식의 입력값 제한
    3) 추가 명령어 실행에 사용되는 &, |, ; 등의 문자를 필터링 한다.

* 운영체제 명령어 공격을 막기 위한 방법

  * 직접적으로 사이트에서 명령어를 보내지 않고 서버에서 처리하도록 한다.

  * 사용자 화면에서 넘어 온 코드를 실제 사용할 명령어로 맵핑

    

* **XPath 삽입**
  XML 문서에 저장된 데이터를 애플리케이션에서 검색하거나 읽기 위해 XPath를 사용한다. 사용자의 입력값이 검증 작업을 거치지 않고 XPath 쿼리의 일부 값으로 삽이되어 사용된다면, 공격자는 입력값을 조작해 애플리케이션 로직을 손상시키도록 쿼리를 변조하거나 권한 없이도 특정 데이터를 추출할 수 있게 된다.

* **LDAP 삽입**
  기업 사용자 정보를 집중화하고 수천명의 사용자를 논리적인 그룹으로 배분한 후 서로 다른 시스템 사이에서 통일된 사용자 정보 공유를 가능하게 해 주는 용도로 사용된다.



## 2. 세션 및 인증 관리 취약

​	세션을 사용하는 인증. 
​	인증시도 횟수를 제한한다. 
​	인증정보 생성 관리





# **Term**

* ORM(Object-Relational Mapping)